# mu Lisp

この記事は[進捗 Advent Calendar 2020](https://github.com/t-sin/shinchoku-advent-calendar-2020)の25日目の記事です。

## あらまし

新しくLispを作ってみたいなと考えています。

## 背景

リスをLispで実装したい話は[24日目の記事](2020-12-24.md)に書きました。その中で仮想機械への道を歩みたくなった話もしましたね。実際に[言語設計を途中までしていた](https://github.com/t-sin/mark/blob/virtual-machine/docs/language-design.md)のはまだ書いていませんでした。今日はこの話のつづきです。

### Common Lispのちょっと残念だと思っている点

ところでCommon Lispのこと大好きなんですが大好きなりには若干不満があって、たまに悩んだりすることがあります。ここからは個人の意見として受け取ってください。不満ポイントをざっくり要約して言うと「古い時代の事情を勘案した仕様が更新されずに残りつづけている」点です。たとえば個人的には`#\newline`は嫌いです。その対応文字が仕様にないため処理系によって`#\newline`の処理はまちまちで、これだけでラッパーライブラリがほしくなったりもします。処理系ごとにまちまちな改行コード処理をするくらいならいっそ`#\linefeed`と`#\return`で渡してほしいと思ったことが何度かあります。そのような古い事情を残しつづけた部分が (後方互換性とかではなく最新の仕様として) Common Lispにはいくつかあり、回避できることもありますが「さすがに仕様を現代のマシンに合わせてアップデートしたほうがよいのでは」と思ってしまいます。

また、規格に従っていればCommon Lispを名乗れる、と言うと聞こえはいいですが、裏を返せばポータビリティに難があるということでもあります。実装が複数あることで処理系同士が戦ってよりよい (たとえば速いであるとか、付加機能が充実しているとか) 処理系が現われてくれればそれでいいのですが、現在はもうCommon Lisp処理系といえばたいていSBCL一択です。それと、処理系によって規格外の機能の実装様式に違いがあるため「Common Lispとして」どの処理系でも動くコードを書くにはポータブルに対象を実現できるライブラリの手を借りなければなりません (あるいはなければつくらねばならない) 。

これ怒られそう。

でもその他の点においてはとっても大好きで使っていてほんとうに脳汁がでるレベルなので、これからもCommon Lispバリバリ使っていくと思うんですよね。

### 自分だけのLispをつくって移住してみたい件

それとは別に、自作言語の世界に住むことに前から憧れていました。加えて上で述べたようなCommon Lispへの不満点があり、Sciurusをまた作り直して自分好みの言語にするとドヤれて楽しいのではと思いました。が、リスを実装するのはどこへいくんだ、となるわけです。

この[言語設計 (途中)](https://github.com/t-sin/mark/blob/virtual-machine/docs/language-design.md)を見るとわかるのですが、かなりデカいですよね。こんなの実装してたらリスも実装できず移住もできず、なによりまだまだ調査や修練が足りないので完成しないのではないでしょうか。

つまり、SciurusでマイLisp移住をやるのは複数のことを同時にやろうとしておりリスを実装するならそっちに集中しなさいという話でもある。

じゃあ別のプロジェクトとしてじっくりやってくしかないかー、というのが背景です。

## mu

そんなわけでmuという名前のLisp処理系をつくる気持ちになりました。ミュウがすきなのでmuです。

とはいえ、この処理系はまだまだ言語設計の段階にあり、実行方式もなんにも決まっていません。GitHubにリポジトリもありません (手元にはいちおうあります)。動的束縛どうしよう必要かしら、とかそのレベルで悩んでいます。仮想機械でいくとしても[19日目の記事](2020-12-19.md)のSECDマシンの調査を終えてからやりたいですし、ネイティブコードコンパイラとなるとそれはもう…。

また、ぼくのやりたいことって音声信号処理とかメディアプログラミングなので性能要件が厳しめで、その点でも頓挫の気配がぷんぷんします。

### 既存のmu Lisp

ちなみに過去にmuの名のつくLispはいくつかあったようです。

- Microsoft LISPになったもの: http://www.edm2.com/index.php/MuLISP
- Cによる実装: https://github.com/MattX/mulisp

あとひとつ、日本語の古めのページでmuという名前のLisp処理系を見かけた気がしますが、出てこない…。

---

たぶん完成することはないと思うのですが、アドベントカレンダーの締めにはちょうどよい未来的なことなので25日目の記事とさせていただきます。

## アドベントカレンダーのおわりに

というわけでエタったり途中だったり未定だったり表に出してなかったりすることを書く、進捗アドベントカレンダー2020は終了です。最後まで読んでいただきありがとうございます。また、参加していただいた[@cxxxrさん](https://github.com/cxxxr) (4日目)、[@niyarinさん](https://github.com/niyarin) (8日目)、[@taniさん](https://github.com/tani) (22日目)、参加いただきほんとうにありがとうございました！ 参加いただいた日はゆっくりすごせました！

GitHubのアカウントはみんな持ってるわけだし技術記事だったらGitHubでリポジトリつくってやるのもありなのでは、とcxxxrさんと話していたのがきっかけのアドベントカレンダーでした。ぼくのメンタル的な問題のせいで2回中断が入ってしまいましたが、なんとか完走できてよかったです。ここ5、6年のネタはすべて出しきったので、参加人数が多いことがわかっていれば (＝ぼくが書く数が3、4くらいだったら) 来年もやるかもしれません。
